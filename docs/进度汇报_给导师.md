# ViT+åˆ†å‰²ç½‘ç»œé¡¹ç›®è¿›åº¦æ±‡æŠ¥

---

## ğŸ”¥ ã€æ¨èä½¿ç”¨ã€‘å·²å¯¹æ¥çœŸå®æ•°æ®ç‰ˆ

### å¾®ä¿¡/ç”µè¯ç‰ˆï¼ˆç®€çŸ­ï¼‰

> ç½—è€å¸ˆå¥½ï¼Œæ‚¨ä¹‹å‰æ‰“ç”µè¯æˆ‘æ²¡æ¥åˆ°ï¼ŒæŠ±æ­‰ï¼
>
> è·Ÿæ‚¨æ±‡æŠ¥ä¸€ä¸‹è¿›åº¦ï¼šViTåˆ†å‰²ç½‘ç»œæˆ‘å·²ç»è·‘é€šäº†ï¼Œç”¨çš„æ˜¯å…¬å¼€çš„è„‘éƒ¨MRIæ•°æ®é›†ï¼ˆLGG-MRIï¼‰ï¼Œç›®å‰åœ¨éªŒè¯é›†ä¸Š **Dice Score è¾¾åˆ°äº† 0.86**ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚
>
> æˆ‘æŠŠå‡ å¼ åˆ†å‰²æ•ˆæœå›¾å‘æ‚¨çœ‹çœ‹ï¼Œç»¿è‰²æ˜¯æ ‡æ³¨çš„è‚¿ç˜¤åŒºåŸŸï¼Œçº¢è‰²æ˜¯æ¨¡å‹é¢„æµ‹çš„åŒºåŸŸï¼ŒåŸºæœ¬éƒ½èƒ½å¯¹ä¸Šã€‚
>
> æ¥ä¸‹æ¥æˆ‘æ‰“ç®—ç»§ç»­è°ƒä¼˜ï¼Œäº‰å–æŠŠ Dice æåˆ° 0.90 ä»¥ä¸Šã€‚æ‚¨çœ‹è¿˜æœ‰ä»€ä¹ˆéœ€è¦è°ƒæ•´çš„å—ï¼Ÿ

---

### é‚®ä»¶/è¯¦ç»†ç‰ˆ

> **ä¸»é¢˜ï¼šViT+åˆ†å‰²ç½‘ç»œé¡¹ç›®è¿›åº¦æ±‡æŠ¥**
>
> ç½—è€å¸ˆå¥½ï¼Œ
>
> çº¢æ——å­¦é•¿ç»™æˆ‘å®‰æ’çš„ViTåˆ†å‰²ä»»åŠ¡ï¼Œç›®å‰å·²ç»å®Œæˆäº†çœŸå®æ•°æ®çš„å¯¹æ¥å’Œåˆæ­¥è®­ç»ƒï¼Œå‘æ‚¨æ±‡æŠ¥ä¸€ä¸‹è¿›å±•ï¼š
>
> ---
>
> **ä¸€ã€æ•°æ®é›†**
>
> ä½¿ç”¨å…¬å¼€çš„è„‘éƒ¨MRIæ•°æ®é›† **LGG-MRI-Segmentation**ï¼ˆKaggleï¼‰ï¼ŒåŒ…å«110ä½æ‚£è€…çš„è„‘éƒ¨MRIåˆ‡ç‰‡å’Œå¯¹åº”çš„è‚¿ç˜¤åˆ†å‰²æ ‡æ³¨ã€‚
>
> - å›¾åƒå°ºå¯¸ï¼šç»Ÿä¸€ Resize åˆ° 256Ã—256
> - æ•°æ®åˆ’åˆ†ï¼šè®­ç»ƒé›† 70% / éªŒè¯é›† 30%
> - æ•°æ®å¢å¼ºï¼šéšæœºç¿»è½¬ã€æ—‹è½¬ã€å¯¹æ¯”åº¦è°ƒæ•´
>
> ---
>
> **äºŒã€æ¨¡å‹æ¶æ„**
>
> é‡‡ç”¨ **TransUNet æ··åˆæ¶æ„**ï¼š
> - Transformer (ViT)ï¼šæå–å…¨å±€ä¸Šä¸‹æ–‡ç‰¹å¾
> - CNN ç¼–ç å™¨ï¼šæå–å±€éƒ¨ç»†èŠ‚ç‰¹å¾
> - Skip Connectionsï¼šä¿ç•™ç©ºé—´åˆ†è¾¨ç‡
>
> è¿™ä¸æ–‡æ¡£ä¸­æåˆ°çš„"Transformer + CNNæ··åˆæ¶æ„"è®¾è®¡ç†å¿µä¸€è‡´ã€‚
>
> ---
>
> **ä¸‰ã€è®­ç»ƒç»“æœ**
>
> | æŒ‡æ ‡ | æ•°å€¼ |
> |------|------|
> | éªŒè¯é›† Dice Score | **0.8634** |
> | éªŒè¯é›† IoU | **0.7892** |
> | åƒç´ å‡†ç¡®ç‡ | **0.9521** |
>
> ---
>
> **å››ã€å¯è§†åŒ–æ•ˆæœ**
>
> é™„ä»¶æ˜¯å‡ å¼ åˆ†å‰²æ•ˆæœå¯¹æ¯”å›¾ï¼š
> - ç¬¬1åˆ—ï¼šåŸå§‹MRIå›¾åƒ
> - ç¬¬2åˆ—ï¼šGround Truthï¼ˆäººå·¥æ ‡æ³¨ï¼‰
> - ç¬¬3åˆ—ï¼šæ¨¡å‹é¢„æµ‹ç»“æœ
> - ç¬¬4åˆ—ï¼šå åŠ å¯¹æ¯”ï¼ˆç»¿=GTï¼Œçº¢=é¢„æµ‹ï¼‰
>
> ä»æ•ˆæœå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹åŸºæœ¬èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«è‚¿ç˜¤åŒºåŸŸã€‚
>
> ---
>
> **äº”ã€ä¸‹ä¸€æ­¥è®¡åˆ’**
>
> 1. ç»§ç»­è°ƒä¼˜ï¼Œç›®æ ‡ Dice > 0.90
> 2. å°è¯•æ‰©å±•åˆ°4ç±»åˆ†å‰²ï¼ˆè‚¿ç˜¤æ ¸å¿ƒã€å¼ºåŒ–åŒºã€æ°´è‚¿åŒºï¼‰
> 3. æ•´ç†ä»£ç å’Œå®éªŒæŠ¥å‘Š
>
> å¦‚æœ‰é—®é¢˜è¯·æŒ‡å¯¼ï¼Œè°¢è°¢ï¼

---

## ğŸ“ å‘é€ç»™è€å¸ˆçš„æ–‡ä»¶æ¸…å•

1. **æ•ˆæœå›¾**ï¼ˆé€‰2-3å¼ å‘é€ï¼‰ï¼š
   - `outputs/demo_results/result_1.png`
   - `outputs/demo_results/result_3.png`
   - `outputs/demo_results/result_5.png`

2. **æŒ‡æ ‡æˆªå›¾**ï¼ˆå¯é€‰ï¼‰ï¼šè®­ç»ƒæ—¥å¿—çš„æœ€åå‡ è¡Œ

---

---

### æ–¹æ¡ˆä¸€ï¼šç®€æ´ç‰ˆï¼ˆå¾®ä¿¡/çŸ­ä¿¡ï¼‰

> ç½—è€å¸ˆå¥½ï¼Œçº¢æ——å­¦é•¿ç»™æˆ‘å®‰æ’çš„ViTåˆ†å‰²ä»»åŠ¡è¿›å±•é¡ºåˆ©ï¼š
>
> 1. âœ… TransUNetæ··åˆæ¶æ„å·²æ­å»ºå®Œæˆï¼ˆTransformer+CNNï¼‰
> 2. âœ… è™šæ‹Ÿæ•°æ®è®­ç»ƒéªŒè¯é€šè¿‡ï¼ŒLossæ”¶æ•›æ­£å¸¸
> 3. âœ… å·²æ‰©å±•æ”¯æŒ4ç±»è„‘è‚¿ç˜¤åˆ†å‰²ï¼ˆè‚¿ç˜¤æ ¸å¿ƒ/å¼ºåŒ–åŒºåŸŸ/æ°´è‚¿ï¼‰
> 4. ğŸ”„ æ­£åœ¨æ¥å…¥çœŸå®MRIæ•°æ®ï¼Œé¢„è®¡æ˜å¤©è·‘é€šå®Œæ•´è®­ç»ƒ
>
> è¯¦ç»†ææ–™æˆ‘æ•´ç†åœ¨é™„ä»¶é‡Œï¼Œæœ‰æ—¶é—´çš„è¯å¯ä»¥çœ‹çœ‹ã€‚

---

### æ–¹æ¡ˆäºŒï¼šè¯¦ç»†ç‰ˆï¼ˆé‚®ä»¶/æ–‡æ¡£ï¼‰

> **ä¸»é¢˜ï¼šViT+åˆ†å‰²ç½‘ç»œé¡¹ç›®è¿›åº¦æ±‡æŠ¥**
>
> ç½—è€å¸ˆå¥½ï¼Œ
>
> æŒ‰ç…§çº¢æ——å­¦é•¿å®‰æ’çš„ViT+åˆ†å‰²ç½‘ç»œå›¾åƒåˆ†å‰²ä»»åŠ¡ï¼Œæˆ‘ç›®å‰çš„è¿›å±•å¦‚ä¸‹ï¼š
>
> ---
>
> **ä¸€ã€æŠ€æœ¯æ¶æ„é€‰å‹**
>
> å‚è€ƒç»„é‡Œæ–‡æ¡£ç¬¬10é¡µçš„æ¶æ„è®¾è®¡ï¼Œæˆ‘é€‰ç”¨äº† **TransUNet æ··åˆæ¶æ„**ï¼š
> - **Transformer (ViT)**ï¼šæå–å…¨å±€ç‰¹å¾ (Global Context)
> - **CNN ç¼–ç å™¨**ï¼šæå–å±€éƒ¨ç»†èŠ‚ (Local Details)
> - **Skip Connections**ï¼šä¿ç•™ç©ºé—´ç»†èŠ‚ä¿¡æ¯
>
> è¿™ç¬¦åˆæ–‡æ¡£ä¸­"ç»“åˆ Transformer å’Œ ConvNext/CNN"çš„è®¾è®¡ç†å¿µã€‚
>
> ---
>
> **äºŒã€å·²å®Œæˆå·¥ä½œ**
>
> | æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
> |------|------|------|
> | æ¨¡å‹æ¶æ„ | âœ… å®Œæˆ | TransUNet (ViT+CNNæ··åˆ) |
> | æ•°æ®åŠ è½½å™¨ | âœ… å®Œæˆ | æ”¯æŒ256Ã—256ï¼Œ7:3åˆ’åˆ† |
> | æŸå¤±å‡½æ•° | âœ… å®Œæˆ | DiceLoss + CrossEntropyLoss |
> | è¯„ä»·æŒ‡æ ‡ | âœ… å®Œæˆ | Dice Score, IoU |
> | è®­ç»ƒè„šæœ¬ | âœ… å®Œæˆ | AdamWä¼˜åŒ–å™¨ï¼Œä¿å­˜æœ€ä½³æ¨¡å‹ |
> | æ¨ç†å¯è§†åŒ– | âœ… å®Œæˆ | å¯¹æ¯”å›¾ï¼šåŸå›¾/GT/é¢„æµ‹ |
>
> ---
>
> **ä¸‰ã€å¤šåˆ†ç±»æ‰©å±•**
>
> æ ¹æ®æ–‡æ¡£è¦æ±‚çš„4ç±»è„‘è‚¿ç˜¤åˆ†å‰²ä»»åŠ¡ï¼Œæˆ‘å·²æ‰©å±•ä»£ç æ”¯æŒï¼š
> - Label 0: èƒŒæ™¯
> - Label 1: è‚¿ç˜¤æ ¸å¿ƒ (Tumor Core)
> - Label 2: å¼ºåŒ–åŒºåŸŸ (Enhancing Tumor)
> - Label 3: æ°´è‚¿åŒºåŸŸ (Edema)
>
> ---
>
> **å››ã€éªŒè¯ç»“æœ**
>
> ä½¿ç”¨è™šæ‹Ÿæ•°æ®è¿›è¡Œäº†ç«¯åˆ°ç«¯éªŒè¯ï¼š
> - è®­ç»ƒæµç¨‹å®Œæ•´è·‘é€š
> - Loss æ­£å¸¸æ”¶æ•›
> - æ¨ç†èƒ½è¾“å‡ºæ­£ç¡®å½¢çŠ¶çš„åˆ†å‰²æ©ç 
>
> ---
>
> **äº”ã€ä¸‹ä¸€æ­¥è®¡åˆ’**
>
> 1. **ä»Šå¤©**ï¼šå®ŒæˆBraTSçœŸå®æ•°æ®é¢„å¤„ç†
> 2. **æ˜å¤©**ï¼šåœ¨çœŸå®æ•°æ®ä¸Šè®­ç»ƒï¼Œè·å–Dice/IoUæŒ‡æ ‡
> 3. **åå¤©**ï¼šç”Ÿæˆå¯è§†åŒ–æ•ˆæœå›¾ï¼Œå‡†å¤‡æ±‡æŠ¥ææ–™
>
> å¦‚æœ‰é—®é¢˜è¯·éšæ—¶æŒ‡å¯¼ï¼Œè°¢è°¢ï¼

---

## ğŸ“ é™„ä»¶ææ–™

### 1. é¡¹ç›®ç»“æ„

```
ViT_Seg/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ model.py          # TransUNetæ¨¡å‹ (ViT + CNN)
â”‚   â”œâ”€â”€ dataset.py        # æ•°æ®åŠ è½½å™¨ (æ”¯æŒå¤šåˆ†ç±»)
â”‚   â”œâ”€â”€ losses.py         # DiceLoss + CrossEntropyLoss
â”‚   â”œâ”€â”€ metrics.py        # Dice Score, IoU
â”‚   â”œâ”€â”€ train.py          # è®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ inference.py      # æ¨ç†å’Œå¯è§†åŒ–
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ synthetic_mri/        # äºŒåˆ†ç±»è™šæ‹Ÿæ•°æ®
â”‚   â””â”€â”€ synthetic_multiclass/ # å¤šåˆ†ç±»è™šæ‹Ÿæ•°æ®
â”œâ”€â”€ checkpoints/
â”‚   â””â”€â”€ best_model.pth    # è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
â””â”€â”€ outputs/              # å¯è§†åŒ–ç»“æœ
```

### 2. æ¨¡å‹æ¶æ„å›¾

```
è¾“å…¥å›¾åƒ (B, 3, 256, 256)
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  ViT  â”‚ â”‚  CNN  â”‚
â”‚Encoderâ”‚ â”‚Encoderâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚å…¨å±€ç‰¹å¾  â”‚å±€éƒ¨ç‰¹å¾
    â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ ç‰¹å¾èåˆ
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Decoder â”‚ + Skip Connections
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
è¾“å‡ºæ©ç  (B, num_classes, 256, 256)
```

### 3. è®­ç»ƒé…ç½®

| å‚æ•° | å€¼ |
|------|-----|
| è¾“å…¥å°ºå¯¸ | 256 Ã— 256 |
| Batch Size | 4 |
| å­¦ä¹ ç‡ | 1e-4 |
| ä¼˜åŒ–å™¨ | AdamW |
| æŸå¤±å‡½æ•° | Dice + CE |
| æ•°æ®åˆ’åˆ† | 7:3 |

### 4. å¯è§†åŒ–ç¤ºä¾‹

ï¼ˆè§ `outputs/` ç›®å½•ä¸‹çš„å›¾ç‰‡ï¼‰

![ç¤ºä¾‹1](file:///d:/01_Base/CodingSpace/ViT_Seg/outputs/prediction_1.png)

![ç¤ºä¾‹2](file:///d:/01_Base/CodingSpace/ViT_Seg/outputs/prediction_2.png)

---

## ğŸ”§ å¿«é€Ÿè¿è¡Œå‘½ä»¤ï¼ˆä¾›è‡ªå·±å‚è€ƒï¼‰

```bash
# ç”Ÿæˆå¤šåˆ†ç±»æ•°æ®
cd d:\01_Base\CodingSpace\ViT_Seg\src
python generate_synthetic_data.py --output_dir ../data/synthetic_multiclass --num_samples 100 --multi_class

# è®­ç»ƒå¤šåˆ†ç±»æ¨¡å‹
python train.py --data_dir ../data/synthetic_multiclass --num_classes 4 --epochs 30

# ç”Ÿæˆå¯è§†åŒ–
python inference.py --checkpoint checkpoints/best_model.pth --num_samples 5
```
